<script type="text/javascript">
google.maps.event.addDomListener(window, 'load', initialize(41.92, -87.65));

var nBounds = new google.maps.LatLngBounds();

locations = [
  <% mapvenues.each do |venue| %>
  {
    id: <%= venue.id %>,
    lat: '<%= venue.latitude %>',
    lng: '<%= venue.longitude %>',
    name: '<%= venue.name %>',
    path: '<%= venue_path(venue) %>',
    isTry: <% if user_signed_in? and Try.where('user_id = ? AND venue_id = ?', current_user.id, venue.id).exists? %>true<% else %>false<% end %>,
    isBar: <% if venue.venuetype.isBar %>true<% else %>false<% end %>
  },
  <% end %>
];

for (i = 0; i < locations.length; i++) {
  var iconSymbol;
  if (locations[i]['isBar']) {
    iconSymbol = '/images/mug.svg';
  } else {
    iconSymbol = '/images/spoon-knife.svg';
  }
	var thisLatLng = new google.maps.LatLng(locations[i]['lat'], locations[i]['lng'])
  marker = new google.maps.Marker({
    position: thisLatLng,
    map: map,
    icon: iconSymbol
  });
	nBounds.extend(thisLatLng);
  marker.set('id', locations[i]['id']);
  marker.set('isBar', locations[i]['isBar']);
  marker.set('isTry', locations[i]['isTry']);
  markerList.push(marker);

  google.maps.event.addListener(marker, 'click', (function(marker, i) {
    return function() {
      map.panTo(marker.getPosition());
      infowindow.setContent('<div class="map-infowindow"><a href="' + locations[i]['path'] + '">' + locations[i]['name'] +'</a></div>');
      infowindow.open(map, this);
    }
  })(marker, i));
}
/*var markerCluster = new MarkerClusterer(map, markerList, {
  maxZoom: 13,
  gridSize: 20,
  minimumClusterSize: 2
});*/

map.fitBounds(nBounds);
</script>
